<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜í•™ ìš©ì–´ í€´ì¦ˆ</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
    .question-box { background: #fff; padding: 15px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .question-box h3 { color: #007bff; }
    .option { margin: 8px 0; }
    .explanation { margin-top: 5px; color: #555; }
    .result-box { background: #e2f0d9; padding: 15px; margin-top: 20px; border-radius: 8px; }
    button, select { padding: 10px 20px; font-size: 16px; margin-top: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    select { background: white; color: black; border: 1px solid #ccc; }
  </style>
</head>
<body>

  <h1>ì˜í•™ ìš©ì–´ í€´ì¦ˆ</h1>

  <label for="fileSelector">ğŸ”½ ë¬¸ì œ ì„ íƒ:</label>
  <select id="fileSelector" onchange="loadQuiz()">
    <option value="medical_quiz_20250408.json">2025-04-08 ì‹ ê·œ ë¬¸ì œ</option>
    <option value="medical_quiz_prefix.json">ì ‘ë‘ì‚¬ ë¬¸ì œ</option>
    <option value="medical_quiz_suffix.json">ì ‘ë¯¸ì‚¬ ë¬¸ì œ</option>
    <option value="medical_quiz_30_korean.json">ê¸°ì¡´ ë³µìŠµ ë¬¸ì œ</option>
  </select>

  <div id="quiz-container"></div>
  <button onclick="submitQuiz()">ì œì¶œí•˜ê¸°</button>
  <div id="result" class="result-box" style="display:none;"></div>

  <script>
    let quizData = [];

    async function loadQuiz() {
      const filename = document.getElementById("fileSelector").value;
      const response = await fetch(filename);
      quizData = await response.json();

      const container = document.getElementById("quiz-container");
      container.innerHTML = "";

      quizData.forEach((q, index) => {
        const optionsHtml = q.options.map(opt => `
          <label class="option">
            <input type="radio" name="q${index}" value="${opt}"> ${opt}
          </label>
        `).join("");

        container.innerHTML += `
          <div class="question-box">
            <h3>${index + 1}. ${q.question}</h3>
            ${optionsHtml}
            <div class="explanation" id="exp${index}"></div>
          </div>
        `;
      });

      document.getElementById("result").style.display = "none";
    }

    function submitQuiz() {
      let score = 0;
      const wrongList = [];

      quizData.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        const explanationDiv = document.getElementById(`exp${index}`);

        if (selected) {
          if (selected.value === q.answer) {
            score++;
            explanationDiv.innerHTML = `âœ… ì •ë‹µì…ë‹ˆë‹¤!<br><strong>í•´ì„¤:</strong> ${q.explanation}`;
          } else {
            explanationDiv.innerHTML = `âŒ ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µ: <strong>${q.answer}</strong><br><strong>í•´ì„¤:</strong> ${q.explanation}`;
            wrongList.push(q);
          }
        } else {
          explanationDiv.innerHTML = `âš ï¸ ì„ íƒí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.<br><strong>ì •ë‹µ:</strong> ${q.answer}<br><strong>í•´ì„¤:</strong> ${q.explanation}`;
          wrongList.push(q);
        }
      });

      // ëˆ„ì  ì €ì¥ + íšŸìˆ˜
      const existingWrong = JSON.parse(localStorage.getItem("wrongAnswers") || "[]");
      const wrongMap = new Map();
      existingWrong.forEach(q => wrongMap.set(q.question, { ...q }));

      wrongList.forEach(q => {
        if (wrongMap.has(q.question)) {
          wrongMap.get(q.question).wrongCount = (wrongMap.get(q.question).wrongCount || 1) + 1;
        } else {
          q.wrongCount = 1;
          wrongMap.set(q.question, q);
        }
      });

      const updatedWrongList = Array.from(wrongMap.values());
      localStorage.setItem("wrongAnswers", JSON.stringify(updatedWrongList));

      const resultBox = document.getElementById("result");
      resultBox.style.display = "block";
      resultBox.innerHTML = `<h2>ì´ ì ìˆ˜: ${score} / ${quizData.length}</h2>`;

      if (wrongList.length > 0) {
        resultBox.innerHTML += `
          <p>ëˆ„ì  ì˜¤ë‹µ ${updatedWrongList.length}ê°œ ì €ì¥ë¨</p>
          <button onclick="goToWrong()">ì˜¤ë‹µë…¸íŠ¸ ë³´ê¸°</button>
        `;
      }
    }

    function goToWrong() {
      if (confirm("ì˜¤ë‹µë…¸íŠ¸ í˜ì´ì§€ë¡œ ì´ë™í• ê¹Œìš”?")) {
        window.location.href = "wrong.html";
      }
    }

    // í˜ì´ì§€ ë¡œë“œì‹œ ê¸°ë³¸ ë¬¸ì œ ìë™ ë¡œë”©
    window.onload = loadQuiz;
  </script>

</body>
</html>
